title: Wmiprvse Spawning Process
author: Roberto Rodriguez @Cyb3rWard0g
date: 2019/08/15
description: Detects wmiprvse spawning processes
detection:
    SELECTION_1:
        EventID: 1
    SELECTION_10:
        Image: '*\WerFault.exe'
    SELECTION_11:
        LogonId|re: ^$
    SELECTION_12:
        SubjectLogonId|re: ^$
    SELECTION_2:
        ParentImage: '*\WmiPrvSe.exe'
    SELECTION_3:
        LogonId: '0x3e7'
    SELECTION_4:
        LogonId: 'null'
    SELECTION_5:
        SubjectLogonId: '0x3e7'
    SELECTION_6:
        SubjectLogonId: 'null'
    SELECTION_7:
        User: NT AUTHORITY\SYSTEM*
    SELECTION_8:
        User: AUTORITE NT\Sys*
    SELECTION_9:
        Image: '*\WmiPrvSE.exe'
    condition: (SELECTION_1 and ((SELECTION_2 and  not ((SELECTION_3 or SELECTION_4)
        or (SELECTION_5 or SELECTION_6) or (SELECTION_7 or SELECTION_8) or (SELECTION_9
        or SELECTION_10))) and  not (SELECTION_11)) and  not (SELECTION_12))
falsepositives:
- Unknown
id: d21374ff-f574-44a7-9998-4a8c8bf33d7d
level: high
logsource:
    category: process_creation
    product: windows
modified: 2021/08/26
references:
- https://threathunterplaybook.com/notebooks/windows/02_execution/WIN-190810201010.html
status: experimental
tags:
- attack.execution
- attack.t1047
yml_filename: win_wmiprvse_spawning_process.yml
yml_path: /home/itib/git/sigma/rules/windows/process_creation

