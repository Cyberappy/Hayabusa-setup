title: Suspicious PowerShell Keywords
author: Florian Roth, Perez Diego (@darkquassar)
date: 2019/02/11
description: Detects keywords that could indicate the use of some PowerShell exploitation
    framework
detection:
    SELECTION_1:
        EventID: 4104
    SELECTION_10:
        ScriptBlockText: '*Invoke-WMIMethod*'
    SELECTION_11:
        ScriptBlockText: '*http://127.0.0.1*'
    SELECTION_2:
        ScriptBlockText: '*System.Reflection.Assembly.Load($*'
    SELECTION_3:
        ScriptBlockText: '*[System.Reflection.Assembly]::Load($*'
    SELECTION_4:
        ScriptBlockText: '*[Reflection.Assembly]::Load($*'
    SELECTION_5:
        ScriptBlockText: '*System.Reflection.AssemblyName*'
    SELECTION_6:
        ScriptBlockText: '*Reflection.Emit.AssemblyBuilderAccess*'
    SELECTION_7:
        ScriptBlockText: '*Runtime.InteropServices.DllImportAttribute*'
    SELECTION_8:
        ScriptBlockText: '*SuspendThread*'
    SELECTION_9:
        ScriptBlockText: '*rundll32*'
    condition: (SELECTION_1 and (SELECTION_2 or SELECTION_3 or SELECTION_4 or SELECTION_5
        or SELECTION_6 or SELECTION_7 or SELECTION_8 or SELECTION_9 or SELECTION_10
        or SELECTION_11))
falsepositives:
- Penetration tests
id: 1f49f2ab-26bc-48b3-96cc-dcffbc93eadf
level: high
logsource:
    definition: Script block logging must be enabled for 4104
    product: windows
    service: powershell
modified: 2021/08/30
references:
- https://posts.specterops.io/entering-a-covenant-net-command-and-control-e11038bcf462
- https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1
- https://github.com/hlldz/Invoke-Phant0m/blob/master/Invoke-Phant0m.ps1
- https://gist.github.com/MHaggis/0dbe00ad401daa7137c81c99c268cfb7
status: experimental
tags:
- attack.execution
- attack.t1059.001
- attack.t1086
yml_filename: powershell_suspicious_keywords.yml
yml_path: /home/itib/git/sigma/rules/windows/powershell/powershell_script

